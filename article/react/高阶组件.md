## 高阶组件

#### 1. 什么是高阶组件

> 具体而言，高阶组件是参数为组件，返回值为新组件的函数。

> -- React 官方文档

#### 2. 高阶组件的作用

高阶组件用来在不同的React组件之间共享一些逻辑。

分离高层和底层关注点：HOC只关注数据的的逻辑，而不关心数据怎么用；参数组件只关注数据如何使用，而不关注数据的逻辑。

#### 3. 如何实现一个高阶组件

1. 原则
	
	- 高阶组件即一个函数，接受一个组件和一些配置项，根据这些配置项对传入的组件进行包装
	- 高阶组件是纯函数，不会修改传入的参数组件，也不会使用继承来复制其行为（因为新组件和传入的组件并不是父子类关系）。它会返回一个新的组件。
	- 高阶函数返回的新组件可以认为是一个容器组件，而传入的组件从容器组件中接受props，HOC 视为参数化容器组件。

2. 最佳实践
	- 高阶组件应该透传不相关的props
	- 如果有可能有多个高阶组件作用于同一个组件上，那么多个高阶组件最好是入参和出参格式相同，这样就可以使用compose将它们组合在一起，提高可读性。比如，react-redux中的connect可以接受一个参数返回一个高阶组件，这个高阶组件入参和出参都只是一个React组件，这样它就很容易和withRouter组合在一起（使用compose）。
	- 高阶组件名称开头小写（因为它是个函数而不是一个React组件），命名最好以“with”开头，后面的单词表明这个高阶组件做了什么工作。另外高阶组件返回的组件最好有个和高阶组件相同只是开头大写的名称，以方便调试报错时候清楚地知道错误来源

3. 注意事项

- 尽量使用静态高阶组件而不是动态地使用之。比如一个组件每次render时候都使用高阶组件生成一个新的组件并作为子组件的话，那这个子组件每次都会重新装载和卸载（因为React diff算法发现ReactElement的type不同的话，就认为整个子树都是不同的，就会直接卸载重新生成这个子树）。
- 务必复制静态方法。使用高阶组件增强一个组件时候，要注意返回的组件上并没有传入组件的静态方法，那么如果外界使用包装过的组件时候，就无法使用它的静态方法了。为了解决这个问题，我们可以
	1. 通过```hoist-non-react-statics```这个第三方库来将所有非React的静态方法复制到新组件上面。
	2. 直接将静态方法显式导出
- 使用React.forwardRef()传递ref。高阶组件不会传递ref给子组件，因此需要其他方式传递，以便让包装过的组件使用时候可以接收到ref，React.forwardRef()方法提供了这个支持。